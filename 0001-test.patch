From 7da11e693c4b8b150be3283b979fc1f90effb274 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ignacio=20Rodr=C3=ADguez?= <ignacio@sugarlabs.org>
Date: Fri, 12 Dec 2014 11:06:45 -0200
Subject: [PATCH] test

---
 .gitignore | 2 +-
 main.py    | 5 +++++
 run.py     | 8 --------
 run.sh     | 8 ++++++++
 update.py  | 2 ++
 5 files changed, 16 insertions(+), 9 deletions(-)
 delete mode 100644 run.py
 create mode 100644 run.sh

diff --git a/.gitignore b/.gitignore
index 1a76ff2..c0b7359 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,3 +1,3 @@
 *~
 *.py[co~]
-.json
+*.json
diff --git a/main.py b/main.py
index 40fc7c0..fb6b657 100644
--- a/main.py
+++ b/main.py
@@ -26,6 +26,11 @@ orglist = ['sugarlabs',
            'fossasia']
 
 
+@app.route('/update')
+def update():
+    os.system("python update.py &")
+
+
 @app.route('/')
 def index():
     return render_template('index.html')
diff --git a/run.py b/run.py
deleted file mode 100644
index bff4737..0000000
--- a/run.py
+++ /dev/null
@@ -1,8 +0,0 @@
-import gobject
-
-
-def d():
-    print "Hola"
-    return True
-gobject.timeout_add(100, d)
-gobject.init_threads()
diff --git a/run.sh b/run.sh
new file mode 100644
index 0000000..48c930e
--- /dev/null
+++ b/run.sh
@@ -0,0 +1,8 @@
+#!/bin/sh
+python update.py
+python main.py 5000 &
+
+while true; do
+	sleep 5m
+	python update.py
+done
diff --git a/update.py b/update.py
index 314eb32..7d50637 100644
--- a/update.py
+++ b/update.py
@@ -21,7 +21,9 @@ BASEURL = "http://www.google-melange.com/gci/org/google/gci2014/" \
 
 
 def update_orgs():
+    print "Update started"
     for org in orglist:
+        print org
         page_url = BASEURL.format(orgname=org)
         page = requests.get(page_url)
         data = page.json()
-- 
2.1.0

